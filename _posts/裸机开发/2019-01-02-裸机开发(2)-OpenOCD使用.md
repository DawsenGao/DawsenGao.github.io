---
layout: post
title: 裸机开发(2)-OpenOCD使用
description: 
category: 裸机开发
---
# OpenOCD是什么
OpenOCD是一款开源软件，全称Open On-Chip Debugger，最初是由Dominic Rath同学还在大学期间发起的（2005年）项目。OpenOCD旨在提供针对嵌入式设备的调试、系统编程和边界扫描功能。

# 如何使用
```
➜  ~ openocd -h
Open On-Chip Debugger 0.10.0
Licensed under GNU GPL v2
For bug reports, read
	http://openocd.org/doc/doxygen/bugs.html
Open On-Chip Debugger
Licensed under GNU GPL v2
--help       | -h	display this help
--version    | -v	display OpenOCD version
--file       | -f	use configuration file <name>
--search     | -s	dir to search for config files and scripts
--debug      | -d	set debug level <0-3>
--log_output | -l	redirect log output to file <name>
--command    | -c	run <command>
```
当在终端直接输入openocd命令可能会报错：
```
➜  ~ openocd
Open On-Chip Debugger 0.10.0
Licensed under GNU GPL v2
For bug reports, read
	http://openocd.org/doc/doxygen/bugs.html
embedded:startup.tcl:60: Error: Can't find openocd.cfg
in procedure 'script' 
at file "embedded:startup.tcl", line 60
Error: Debug Adapter has to be specified, see "interface" command
embedded:startup.tcl:60: Error: 
in procedure 'script' 
at file "embedded:startup.tcl", line 60
```

如果没有输入 -f 或 -c 的选项命令，OpenOCD会试图读取openocd.cfg这个配置文件。如果定义了不同的配置文件，需要使用-f命令。示例如下：
```
openocd -f config1.cfg -f config2.cfg -f config3.cfg
```
配置文件和脚本按照一定顺序进行目录搜索，首先搜索当前的工作目录。

注意：
1. 一般每个人的JTAG一般不同，这样我们一般需要自定义一些配置来用于适配器，例如这里使用的是easyopenjtag,对于这个设备可以设置相关配置

```
interface ftdi
#通过描述来指定设备，应当和dmesg中的Product一致
#ftdi_device_desc "USB<=>JTAG&RS232"
#通过PID VID指定调试器，比描述更准确些
ftdi_vid_pid 0x1457 0x5118
#如果有多个同样的调试器，还可以指定要使用的调试器序列号
#ftdi_serial
 
#引脚定义，相当于旧版中的 ft2232_layout jtagkey
ftdi_layout_init 0x0c08 0x0f1b
ftdi_layout_signal nTRST -data 0x0100 -noe 0x0400
ftdi_layout_signal nSRST -data 0x0200 -noe 0x0800
```
2. 有些openocd配置文件中，会有下面的定义，这是使用GPIO模拟jtag
```
interface sysfsgpio

#                   tck tms tdi tdo
sysfsgpio_jtag_nums 19 18 7 8

sysfsgpio_trst_num 6
# sysfsgpio_srst_num 6

```


# 参考资料
[OpenOCD User’s Guide](http://openocd.org/doc/html/index.html#toc-About-1)