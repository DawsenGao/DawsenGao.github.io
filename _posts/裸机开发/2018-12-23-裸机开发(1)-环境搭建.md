---
layout: post
title: 裸机开发(1)-Mac OS下使用OpenJTAG
description: 
category: 裸机开发
---
# Mac OS下安装OpenOCD

直接使用brew命令安装
```
brew install openocd
```

安装完成后
```
➜openocd -v
Open On-Chip Debugger 0.10.0
Licensed under GNU GPL v2
For bug reports, read
	http://openocd.org/doc/doxygen/bugs.html
```
# 添加OpenOCD配置文件openocd.cfg：
```
interface ftdi
#通过描述来指定设备，应当和dmesg中的Product一致
#ftdi_device_desc "USB<=>JTAG&RS232"
#通过PID VID指定调试器，比描述更准确些
ftdi_vid_pid 0x1457 0x5118
#如果有多个同样的调试器，还可以指定要使用的调试器序列号
#ftdi_serial
 
#引脚定义，相当于旧版中的 ft2232_layout jtagkey
ftdi_layout_init 0x0c08 0x0f1b
ftdi_layout_signal nTRST -data 0x0100 -noe 0x0400
ftdi_layout_signal nSRST -data 0x0200 -noe 0x0800
 
# Target configuration for the Samsung 2440 system on chip
# Tested on a S3C2440 Evaluation board by keesj
# Processor       : ARM920Tid(wb) rev 0 (v4l)
# Info:   JTAG tap: s3c2440.cpu tap/device found: 0x0032409d (Manufacturer: 0x04e, Part: 0x0324, Version: 0x0)
 
if { [info exists CHIPNAME] } {
   set  _CHIPNAME $CHIPNAME
} else {
   set  _CHIPNAME s3c2440
}
 
if { [info exists ENDIAN] } {
   set  _ENDIAN $ENDIAN
} else {
  # this defaults to a bigendian
   set  _ENDIAN little
}
 
if { [info exists CPUTAPID ] } {
   set _CPUTAPID $CPUTAPID
} else {
  # force an error till we get a good number
   set _CPUTAPID 0x0032409d
}
 
#jtag scan chain
jtag newtap $_CHIPNAME cpu -irlen 4 -ircapture 0x1 -irmask 0x0f -expected-id $_CPUTAPID
 
#
#jtag_rclk 3000
adapter_khz 1234
 
#set _TARGETNAME $_CHIPNAME.cpu
#target create $_TARGETNAME arm920t -endian $_ENDIAN -chain-position $_TARGETNAME -variant arm920t
#$_TARGETNAME configure -work-area-phys 0x200000 -work-area-size 0x4000 -work-area-backup 0
#arm7_9 fast_memory_access enable
 
 
set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME arm920t -chain-position $_TARGETNAME
$_TARGETNAME configure -work-area-phys 0x00200000 \
-work-area-size 0x4000 -work-area-backup 0
 
 
#reset configuration
reset_config trst_and_srst
 
#Flash CFG<openocd.pdf P[74~]
#flash bank name driver base size chip_width bus_width target [driver_options]
#usage: flash bank <name> <driver> <base> <size> <chip_width> <bus_width> <target>
#flash bank bank_id driver_name base_address size_bytes chip_width_bytes bus_width_bytes target [driver_options ...]
flash bank 0 cfi 0x0 0x200000 2 2 $_TARGETNAME
 
#NAND CFG <openocd.pdf P[88~92]>
#nand device name driver target [ configparams... ]
nand device 0 s3c2440 $_TARGETNAME
``` 

# 如何使用OpenOCD
1.启动OpenOCD：首先将EasyOpenJTAG USB连接至Mac，然后开发板上电   
2.在配置文件openocd.cfg相同目录执行openocd，否则会出现Error: Can't find openocd.cfg   
3.启动另一个终端，命令行中通过telnet localhost 4444 登陆openocd,通过load_imag下载文件   


